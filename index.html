<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Wellness Planner</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent-color-light: #6C63FF;
            --accent-color-translucent-light: rgba(108, 99, 255, 0.15);
            --new-todo-btn-shadow-light: 0 4px 15px rgba(108, 99, 255, 0.3);
            --new-todo-btn-hover-shadow-light: 0 6px 20px rgba(108, 99, 255, 0.4);
            --bg-image-light: linear-gradient(120deg, #eacdd7 0%, #cdd6e8 100%);
            --widget-bg-light: rgba(255, 255, 255, 0.45);
            --widget-border-light: rgba(255, 255, 255, 0.7);
            --header-bg-light: rgba(255, 255, 255, 0.35);
            --sidebar-bg-light: rgba(255, 255, 255, 0.25);
            --text-color-light: #2c3e50;
            --text-light-light: #576574;
            --shadow-light: 0 8px 32px 0 rgba(108, 99, 255, 0.1);
            --sidebar-shadow-light: 3px 0px 25px -5px rgba(108, 99, 255, 0.15);
            --header-shadow-light: 0 3px 25px -5px rgba(108, 99, 255, 0.15);
            --danger-color-light: #e74c3c;
            
            --bg-image: var(--bg-image-light);
            --widget-bg: var(--widget-bg-light);
            --widget-border-color: var(--widget-border-light);
            --header-bg: var(--header-bg-light);
            --sidebar-bg: var(--sidebar-bg-light);
            --text-color: var(--text-color-light);
            --text-light: var(--text-light-light);
            --accent-color: var(--accent-color-light);
            --accent-color-translucent: var(--accent-color-translucent-light);
            --nav-link-color: var(--text-color-light);
            --nav-link-hover-bg: rgba(255, 255, 255, 0.2);
            --progress-bar-bg: rgba(44, 62, 80, 0.1);
            --progress-bar-fill-1: #8f8aff;
            --progress-bar-fill-2: var(--accent-color-light);
            --progress-bar-fill-complete: #2ecc71;
            --icon-color: var(--text-color-light);
            --button-bg: rgba(255, 255, 255, 0.3);
            --button-text: var(--text-color-light);
            --box-shadow: var(--shadow-light);
            --sidebar-shadow: var(--sidebar-shadow-light);
            --header-shadow: var(--header-shadow-light);
            --modal-overlay-bg: rgba(0, 0, 0, 0.4);
            --input-bg: rgba(255, 255, 255, 0.2);
            --danger-color: var(--danger-color-light);
            --danger-color-hover: #c0392b;
            --warning-color: #f1c40f;
            --new-todo-btn-bg: var(--accent-color-light);
            --new-todo-btn-text: #ffffff;
            --new-todo-btn-shadow: var(--new-todo-btn-shadow-light);
            --new-todo-btn-hover-shadow: var(--new-todo-btn-hover-shadow-light);
        }

        body.dark-mode {
            --accent-color-dark: #8B84FF;
            --accent-color-translucent-dark: rgba(139, 132, 255, 0.15);
            --new-todo-btn-shadow-dark: 0 4px 15px rgba(139, 132, 255, 0.2);
            --new-todo-btn-hover-shadow-dark: 0 6px 20px rgba(139, 132, 255, 0.3);
            --bg-image-dark: linear-gradient(120deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            --widget-bg-dark: rgba(20, 25, 30, 0.45);
            --widget-border-dark: rgba(255, 255, 255, 0.15);
            --header-bg-dark: rgba(20, 25, 30, 0.35);
            --sidebar-bg-dark: rgba(20, 25, 30, 0.25);
            --text-color-dark: #ecf0f1;
            --text-light-dark: #bdc3c7;
            --shadow-dark: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            --sidebar-shadow-dark: 3px 0px 25px -5px rgba(0, 0, 0, 0.25);
            --header-shadow-dark: 0 3px 25px -5px rgba(0, 0, 0, 0.25);
            --danger-color-dark: #e74c3c;

            --bg-image: var(--bg-image-dark);
            --widget-bg: var(--widget-bg-dark);
            --widget-border-color: var(--widget-border-dark);
            --header-bg: var(--header-bg-dark);
            --sidebar-bg: var(--sidebar-bg-dark);
            --text-color: var(--text-color-dark);
            --text-light: var(--text-light-dark);
            --accent-color: var(--accent-color-dark);
            --accent-color-translucent: var(--accent-color-translucent-dark);
            --nav-link-color: var(--text-color-dark);
            --nav-link-hover-bg: rgba(0, 0, 0, 0.2);
            --progress-bar-bg: rgba(236, 240, 241, 0.1);
            --progress-bar-fill-1: #a099ff;
            --progress-bar-fill-2: var(--accent-color-dark);
            --progress-bar-fill-complete: #27ae60;
            --icon-color: var(--text-color-dark);
            --button-bg: rgba(0, 0, 0, 0.2);
            --button-text: var(--text-color-dark);
            --box-shadow: var(--shadow-dark);
            --sidebar-shadow: var(--sidebar-shadow-dark);
            --header-shadow: var(--header-shadow-dark);
            --modal-overlay-bg: rgba(0, 0, 0, 0.5);
            --input-bg: rgba(0, 0, 0, 0.15);
            --danger-color: var(--danger-color-dark);
            --danger-color-hover: #c0392b;
            --warning-color: #f39c12;
            --new-todo-btn-bg: var(--accent-color-dark);
            --new-todo-btn-shadow: var(--new-todo-btn-shadow-dark);
            --new-todo-btn-hover-shadow: var(--new-todo-btn-hover-shadow-dark);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', 'Segoe UI', 'Roboto', sans-serif;
            background-image: var(--bg-image);
            color: var(--text-color);
            transition: background-image 0.5s, color 0.5s;
            background-attachment: fixed;
            padding-top: 80px;
            padding-left: 240px;
        }

        #loader {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: var(--bg-image);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: var(--accent-color);
            z-index: 9999;
            transition: opacity 0.3s;
        }

        #app-container { display: none; }

        .glass {
            background: var(--widget-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--widget-border-color);
            box-shadow: var(--box-shadow);
            border-radius: 16px;
            transition: background 0.3s, border 0.3s, box-shadow 0.3s;
        }
        
        header {
            padding: 0 10px 0 20px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 10px;
            right: 10px;
            left: 240px;
            z-index: 1000;
            background: var(--header-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: var(--header-shadow);
            border-radius: 16px;
            border: 1px solid var(--widget-border-color);
        }

        .logo { width: 45px; height: 45px; position: relative; }
        .logo img {
            width: 100%; height: 100%;
            border-radius: 50%;
            border: 2px solid var(--widget-border-color);
            object-fit: cover; cursor: pointer; background-color: white;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .logo img:hover { transform: scale(1.08); box-shadow: 0 0 12px var(--accent-color-translucent); }
        .logo input[type="file"] { display: none; }

        .delete-avatar-btn {
            position: absolute; top: -5px; right: -5px;
            width: 24px; height: 24px;
            background-color: var(--danger-color); color: white;
            border: 2px solid var(--widget-bg); border-radius: 50%;
            cursor: pointer; font-size: 1.1em; line-height: 20px;
            text-align: center; opacity: 0; transform: scale(0.8);
            transition: opacity 0.2s, transform 0.2s; z-index: 10;
        }
        .logo:hover .delete-avatar-btn { opacity: 1; transform: scale(1); }
        .delete-avatar-btn:hover { background-color: var(--danger-color-hover); transform: scale(1.1); }
        
        header nav { margin: 0 20px; flex-grow: 1; }
        header nav a {
            color: var(--nav-link-color); text-decoration: none;
            margin: 0 10px; font-weight: 500; padding: 8px 12px;
            border-radius: 10px; font-size: 0.9em;
            transition: background-color 0.3s, color 0.3s;
        }
        header nav a:hover { background-color: var(--nav-link-hover-bg); color: var(--accent-color); }
        
        .header-right { display: flex; align-items: center; gap: 15px; }
        .search-bar {
            display: flex; align-items: center; background: var(--widget-bg);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--widget-border-color); box-shadow: var(--box-shadow);
            border-radius: 25px; padding: 0 0 0 15px; height: 42px;
            flex-shrink: 1; min-width: 200px;
        }
        .search-bar input[type="search"] {
            flex-grow: 1; background: transparent; border: none;
            outline: none; color: var(--text-color); height: 100%;
            font-size: 0.9em; font-family: 'Poppins', sans-serif;
        }
        .search-bar input[type="search"]::placeholder { color: var(--text-light); opacity: 0.8; }
        .search-bar button {
            display: flex; align-items: center; justify-content: center;
            background: transparent; border: none;
            border-left: 1px solid var(--widget-border-color);
            color: var(--accent-color); height: 60%; padding: 0 12px;
            margin: 0 5px; cursor: pointer; font-size: 1.2em;
        }
        #signOutBtn {
            padding: 8px 16px; background-color: var(--danger-color);
            color: white; border: none; border-radius: 20px;
            cursor: pointer; font-weight: bold;
            transition: background-color 0.2s;
        }
        #signOutBtn:hover { background-color: var(--danger-color-hover); }
        
        .left-sidebar {
            position: fixed; top: 10px; left: 10px;
            width: 220px; height: calc(100vh - 20px);
            padding: 20px; display: flex; flex-direction: column;
            gap: 15px; z-index: 1001;
            background: var(--sidebar-bg); backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--widget-border-color);
            box-shadow: var(--sidebar-shadow); border-radius: 16px;
            overflow-y: auto;
        }

        #newPageBtn {
            padding: 12px; background: var(--new-todo-btn-bg);
            color: var(--new-todo-btn-text); border: none;
            border-radius: 12px; cursor: pointer; font-weight: 600;
            font-size: 1em; text-align: center; width: 100%;
            box-shadow: var(--new-todo-btn-shadow);
            transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
            flex-shrink: 0;
        }
        #newPageBtn:hover, #newPageBtn:focus {
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--new-todo-btn-hover-shadow); outline: none;
        }

        .sidebar-tab-button {
            padding: 10px 12px; background: var(--button-bg);
            color: var(--text-color); border: 1px solid transparent;
            border-radius: 12px; cursor: pointer; font-weight: 500;
            text-align: left; transition: background 0.3s, border 0.3s, transform 0.2s;
            width: 100%; display: flex; align-items: center;
            font-size: 0.9em; flex-shrink: 0;
        }
        .sidebar-tab-button:hover {
            background: var(--widget-bg); border-color: var(--widget-border-color);
            transform: translateX(5px);
        }
        .sidebar-tab-button .tab-icon { margin-right: 12px; font-size: 1.2em; color: var(--accent-color); }
        
        #sidebarStreakBtn { margin-top: auto; }
        .mood-tracker-launcher {
            width: 100%; box-sizing: border-box; display: flex;
            flex-wrap: wrap; justify-content: center; gap: 8px;
            padding: 12px 8px; background: var(--button-bg); border-radius: 12px;
        }
        .mood-emoji-trigger {
            font-size: 1.8em; cursor: pointer;
            transition: transform 0.2s ease-in-out, filter 0.2s; opacity: 0.7;
        }
        .mood-emoji-trigger:hover { transform: scale(1.25); opacity: 1; filter: saturate(1.5); }
        
        .sidebar-weather { background: var(--button-bg); border-radius: 12px; padding: 12px; margin-top: 15px; }
        .sidebar-weather .weather-header { display: flex; align-items: center; gap: 10px; }
        .sidebar-weather #weatherIcon { font-size: 2.2em; }
        .sidebar-weather .weather-details { display: flex; flex-direction: column; }
        .sidebar-weather #weatherTemp { font-size: 1.3em; font-weight: 600; }
        .sidebar-weather #weatherCity { font-size: 0.8em; color: var(--text-light); }
        .sidebar-weather #weatherDesc { font-size: 0.8em; margin-top: 8px; text-align: center; color: var(--text-light); }
        
        .main-content { padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        
        .motivational-quote-banner {
            padding: 15px 25px; display: flex; justify-content: center;
            align-items: center; gap: 20px; background: var(--widget-bg);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--widget-border-color); box-shadow: var(--box-shadow);
            border-radius: 16px;
        }
        #motivationalQuoteP {
            font-style: italic; color: var(--text-light); flex-grow: 1;
            text-align: center; font-size: 1em; font-weight: 300;
        }
        #streakDisplay {
            display: flex; align-items: center; gap: 8px;
            font-size: 1.3em; font-weight: 600; color: var(--accent-color);
            background: var(--widget-bg); padding: 8px 15px;
            border-radius: 25px; cursor: default; width: fit-content;
            margin: 0 auto; border: 1px solid var(--widget-border-color);
        }
        #streakDisplay .fire-icon { font-size: 1.4em; animation: flicker 1.5s ease-in-out infinite; }
        @keyframes flicker {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .widgets-container {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 0; background: var(--widget-bg); backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px); border-radius: 16px;
            border: 1px solid var(--widget-border-color); overflow: hidden;
            box-shadow: var(--box-shadow);
        }
        
        .widget { padding: 20px; display: flex; flex-direction: column; transition: transform 0.2s ease; }
        .widget:hover { transform: translateY(-2px) scale(1.01); z-index: 10; }
        .widgets-container > .widget {
            border-bottom: 1px solid var(--widget-border-color);
            border-right: 1px solid var(--widget-border-color);
        }
        
        .drag-handle { cursor: grab; }
        .drag-handle:active { cursor: grabbing; }
        .sortable-ghost { opacity: 0.4; background: var(--accent-color-translucent); border: 2px dashed var(--accent-color); }
        
        .widget h2 { margin-bottom: 15px; font-size: 1.4em; color: var(--text-color); font-weight: 600; }
        .widget .widget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .widget .widget-header h2 { margin-bottom: 0; flex-grow: 1; margin-right: 10px; }
        .widget .close-btn {
            background: none; border: none; font-size: 1.8em;
            cursor: pointer; color: var(--icon-color); padding: 0 5px;
            line-height: 1; opacity: 0.6; transition: opacity 0.2s, transform 0.2s;
        }
        .widget .close-btn:hover { opacity: 1; transform: scale(1.2) rotate(90deg); }
        
        .reminders-widget ul#remindersList {
            list-style: none; padding: 0; margin-bottom: 15px;
            max-height: 250px; overflow-y: auto; padding-right: 5px;
        }
        .reminders-widget li {
            padding: 10px; border-bottom: 1px solid var(--widget-border-color);
            display: flex; align-items: center; gap: 10px;
            transition: background-color 0.2s, opacity 0.4s ease; border-radius: 8px;
        }
        .reminders-widget li:hover { background-color: var(--accent-color-translucent); }
        .reminders-widget li:last-child { border-bottom: none; }
        .reminders-widget .reminder-checkbox {
            accent-color: var(--accent-color); width: 18px; height: 18px;
            flex-shrink: 0; cursor: pointer;
        }
        .reminders-widget .reminder-details { flex-grow: 1; }
        .reminders-widget .reminder-text { color: var(--text-color); cursor: pointer; padding: 2px 4px; border-radius: 3px; font-size: 0.95em; }
        .reminders-widget .reminder-date { font-size: 0.8em; color: var(--accent-color); font-weight: 500; margin-top: 4px; }
        .reminders-widget .delete-reminder-btn {
            background: none; border: none; color: var(--danger-color);
            font-size: 1.3em; font-weight: bold; cursor: pointer;
            padding: 0 5px; line-height: 1; border-radius: 50%;
            transition: color 0.2s, background-color 0.2s, transform 0.2s;
            flex-shrink: 0;
        }
        .reminders-widget .delete-reminder-btn:hover { color: white; background-color: var(--danger-color-hover); transform: scale(1.1); }
        .add-reminder-form { display: flex; gap: 10px; margin-top: auto; border-top: 1px solid var(--widget-border-color); padding-top: 15px; }
        .add-reminder-form #newReminderInput {
            flex-grow: 1; padding: 8px 12px; border: 1px solid var(--widget-border-color);
            border-radius: 8px; background-color: var(--input-bg);
            color: var(--text-color); font-size: 0.9em; outline: none;
            transition: box-shadow 0.2s; font-family: 'Poppins', sans-serif;
        }
        .add-reminder-form #newReminderInput:focus { box-shadow: 0 0 0 3px var(--accent-color-translucent); }
        .add-reminder-form #newReminderInput::placeholder { color: var(--text-light); opacity: 0.8; }
        .add-reminder-form #addReminderBtn {
            padding: 8px 15px; background-color: var(--accent-color);
            color: white; border: none; border-radius: 8px; cursor: pointer;
            font-weight: bold; font-size: 1em;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .add-reminder-form #addReminderBtn:hover { transform: scale(1.05); box-shadow: var(--new-todo-btn-shadow); }
        
        .todo-card ul.task-list { list-style: none; padding: 0; margin-bottom: 15px; padding-left: 5px; }
        .reminders-widget li, .todo-card li { transition: opacity 0.4s ease; }
        .todo-card ul.task-list li {
            padding: 8px 5px; display: flex; flex-wrap: wrap; align-items: center;
            gap: 5px 10px; border-bottom: 1px solid var(--widget-border-color);
            transition: opacity 0.4s ease, background-color 0.2s; border-radius: 8px;
        }
        .todo-card ul.task-list li:hover { background-color: var(--accent-color-translucent); }
        .todo-card ul.task-list li:last-child { border-bottom: none; }
        .todo-card input[type="checkbox"] {
            margin-right: 5px; accent-color: var(--accent-color);
            width: 18px; height: 18px; flex-shrink: 0; cursor: pointer;
        }
        .todo-card .task-content { display: flex; flex-direction: column; flex-grow: 1; min-width: 0; }
        .todo-card .task-label { color: var(--text-color); word-break: break-word; cursor: pointer; font-size: 0.95em; }
        .todo-card .task-label.overdue { color: var(--danger-color); font-weight: 600; }
        .todo-card .task-label.completed { text-decoration: line-through; color: var(--text-light); opacity: 0.7; }
        .todo-card .task-due-date-input {
            margin-top: 4px; padding: 2px 4px; border: 1px solid transparent; border-radius: 6px;
            font-size: 0.75em; color: var(--text-light); background-color: transparent;
            cursor: pointer; width: fit-content; transition: border 0.2s, color 0.2s;
        }
        .todo-card .task-due-date-input:hover { border-color: var(--widget-border-color); color: var(--accent-color); }
        .todo-card .delete-task-btn {
            background: none; border: none; color: var(--danger-color);
            font-size: 1.3em; font-weight: bold; cursor: pointer; padding: 0 5px;
            line-height: 1; border-radius: 50%;
            transition: color 0.2s, background-color 0.2s, transform 0.2s;
            flex-shrink: 0; margin-left: auto; opacity: 0.6;
        }
        .todo-card .delete-task-btn:hover { opacity: 1; color: white; background-color: var(--danger-color-hover); transform: scale(1.1); }
        
        .progress-item { margin-top: auto; padding-top: 15px; border-top: 1px solid var(--widget-border-color); }
        .progress-bar-container { width: 100%; background-color: var(--progress-bar-bg); border-radius: 10px; height: 10px; overflow: hidden; margin-bottom: 8px; }
        .progress-bar {
            height: 100%; background-color: var(--progress-bar-fill-1); border-radius: 10px;
            transition: width 0.5s ease-in-out, background-color 0.5s ease;
            text-align: center; color: white; font-size: 0; line-height: 10px;
        }
        .progress-label { font-size: 0.85em; color: var(--text-light); text-align: center; font-weight: 500; }
        
        .add-task-btn {
            background-color: var(--accent-color-translucent); color: var(--accent-color);
            border: 1px solid transparent; padding: 6px 12px; border-radius: 8px;
            cursor: pointer; margin-top: 10px; margin-bottom: 5px;
            display: block; width: fit-content; margin-left: auto; margin-right: auto;
            transition: background-color 0.2s, color 0.2s, transform 0.2s;
            font-weight: 500; font-size: 0.9em;
        }
        .add-task-btn:hover { background-color: var(--accent-color); color: white; transform: scale(1.05); }
        
        .horoscope-section { text-align: center; padding: 30px; display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .horoscope-header { display: flex; align-items: center; gap: 12px; }
        .horoscope-icon { font-size: 3em; line-height: 1; }
        .horoscope-header h3 { font-size: 1.8em; margin: 0; color: var(--text-color); font-weight: 600; }
        #getHoroscopeBtn {
            padding: 10px 22px; background-color: var(--accent-color);
            color: white; border: none; border-radius: 25px;
            cursor: pointer; font-weight: 500; font-size: 0.9em;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(108, 99, 255, 0.2);
        }
        #getHoroscopeBtn:hover { transform: scale(1.05); box-shadow: 0 6px 15px rgba(108, 99, 255, 0.4); }

        .calendar-widget {
             --cal-day-hover-bg: var(--accent-color-translucent);
             --cal-today-border: 2px solid var(--accent-color);
             --cal-event-dot-incomplete: var(--danger-color); 
             --cal-event-dot-partial: var(--warning-color); 
             --cal-event-dot-complete: var(--progress-bar-fill-complete);
        }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .calendar-header h3 { margin: 0; font-size: 1.1em; font-weight: 600; }
        .calendar-nav-btn {
            background: none; border: none; font-size: 1.6em; color: var(--icon-color);
            cursor: pointer; padding: 0 8px; border-radius: 50%;
            transition: background-color 0.2s, transform 0.2s;
        }
        .calendar-nav-btn:hover { background-color: var(--button-bg); transform: scale(1.1); }
        .calendar-grid-widget { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .cal-day-name, .cal-day {
            text-align: center; padding: 4px; font-size: 0.8em; font-weight: 500;
            color: var(--text-light); aspect-ratio: 1 / 1;
            display: flex; justify-content: center; align-items: center;
        }
        .cal-day {
            cursor: pointer; border-radius: 50%; position: relative;
            transition: background-color 0.2s, color 0.2s, transform 0.1s ease-out;
            color: var(--text-color);
        }
        .cal-day:hover { background-color: var(--cal-day-hover-bg); transform: scale(1.05); }
        .cal-day.not-current-month { color: var(--text-light); opacity: 0.4; pointer-events: none; }
        .cal-day.today { box-shadow: 0 0 0 var(--cal-today-border); font-weight: 600; }
        .cal-day .event-dot {
            position: absolute; bottom: 5px; left: 50%;
            transform: translateX(-50%); width: 6px; height: 6px;
            border-radius: 50%; transition: background-color 0.3s;
            border: 1px solid var(--widget-bg);
        }
        .cal-day .event-dot.dot-red { background-color: var(--cal-event-dot-incomplete); }
        .cal-day .event-dot.dot-yellow { background-color: var(--cal-event-dot-partial); }
        .cal-day .event-dot.dot-green { background-color: var(--cal-event-dot-complete); }
        
        .modal-overlay {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: var(--modal-overlay-bg);
            display: none; align-items: center; justify-content: center;
            z-index: 1500;
            animation: fadeIn .4s ease-out forwards;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        .modal-overlay.fade-out { animation: fadeOut .4s ease-in forwards; }
        .modal-content {
            background: var(--widget-bg); backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px); border: 1px solid var(--widget-border-color);
            box-shadow: var(--box-shadow); border-radius: 16px; width: 90%;
            transform: scale(.8) translateY(20px); opacity: 0;
            animation: popIn .4s cubic-bezier(.18,.89,.32,1.28) forwards;
        }
        .modal-overlay.fade-out .modal-content { animation: popOut .4s cubic-bezier(.68,-.55,.27,1.55) forwards; }
        
        .calendar-task-tooltip {
            position: fixed; z-index: 2000; padding: 12px 15px; border-radius: 12px;
            pointer-events: none; max-width: 280px; font-size: .9em; opacity: 0;
            transform: scale(.95) translateY(5px);
            transition: opacity .2s ease,transform .2s ease; white-space: normal;
            background: rgba(255,255,255,0.85); backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.9);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        body.dark-mode .calendar-task-tooltip { background: rgba(20, 25, 30, 0.85); border: 1px solid rgba(255,255,255,0.2); }
        .calendar-task-tooltip.visible { opacity: 1; transform: scale(1) translateY(0); }
        .calendar-task-tooltip h4 {
            margin-top: 0; margin-bottom: 8px; font-size: 1em; color: var(--accent-color);
            border-bottom: 1px solid var(--widget-border-color);
            padding-bottom: 5px; font-weight: 600;
        }
        .calendar-task-tooltip ul { list-style: none; padding: 0; margin: 0; }
        .calendar-task-tooltip li { padding: 5px 0; color: var(--text-light); word-break: break-word; }
        .calendar-task-tooltip li:not(:last-child) { border-bottom: 1px dashed var(--widget-border-color); }
        .calendar-task-tooltip li.completed-task { text-decoration: line-through; opacity: .7; }
        
        #moodLoggingModal .modal-content { max-width: 480px; text-align: center; padding: 30px; }
        #moodLoggingModal h3 { margin-top: 0; margin-bottom: 15px; font-size: 1.6em; color: var(--text-color); font-weight: 600; }
        #modalSelectedMoodEmoji { font-size: 4em; margin-bottom: 20px; text-shadow: 0 0 20px var(--accent-color-translucent); }
        #moodNoteInput {
            width: 100%; min-height: 90px; padding: 12px;
            border: 1px solid var(--widget-border-color); border-radius: 12px; margin-bottom: 20px;
            font-family: inherit; font-size: 1em; background-color: var(--input-bg);
            color: var(--text-color); outline: none; transition: box-shadow .2s;
        }
        #moodNoteInput:focus { box-shadow: 0 0 0 3px var(--accent-color-translucent); }
        .modal-actions { padding: 10px 0 0; display: flex; justify-content: flex-end; gap: 12px; }
        .modal-actions button {
            padding: 12px 25px; border-radius: 10px; border: none; cursor: pointer;
            font-weight: 700; margin: 0 5px; transition: transform .2s,box-shadow .2s;
        }
        .modal-actions .save-mood-btn { background-color: var(--accent-color); color: #fff; }
        .modal-actions .cancel-mood-btn { background-color: var(--button-bg); color: var(--text-color); }
        .modal-actions button:hover { transform: translateY(-2px); box-shadow: var(--new-todo-btn-shadow); }
        
        #fullMoodLogViewModal .modal-content { max-width: 700px; height: 80vh; display: flex; flex-direction: column; padding: 0; }
        .modal-header {
            padding: 15px 20px; border-bottom: 1px solid var(--widget-border-color);
            display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;
        }
        .modal-header h3 { margin: 0; font-size: 1.6em; font-weight: 600; color: var(--text-color); }
        .modal-header .close-modal-btn {
            background: none; border: none; cursor: pointer; padding: 5px;
            width: 32px; height: 32px; display: flex; align-items: center;
            justify-content: center; border-radius: 50%;
            transition: background-color .2s, transform .2s;
        }
        .modal-header .close-modal-btn svg { width: 18px; height: 18px; stroke: var(--text-color); stroke-width: 3; transition: stroke .2s; }
        .modal-header .close-modal-btn:hover { background-color: var(--button-bg); transform: scale(1.1) rotate(90deg); }
        .modal-header .close-modal-btn:hover svg { stroke: var(--danger-color); }

        #fullMoodLogViewModal .modal-body { padding: 25px; overflow-y: auto; flex-grow: 1; }
        #fullMoodLogViewModal #fullLogListContainer { list-style: none; padding: 0; }
        #fullMoodLogViewModal #fullLogListContainer li {
            padding: 15px; border-bottom: 1px solid var(--widget-border-color);
            display: flex; gap: 20px; align-items: flex-start;
            border-radius: 12px; transition: background .2s;
        }
        #fullMoodLogViewModal #fullLogListContainer li:hover { background: var(--accent-color-translucent); }
        #fullMoodLogViewModal #fullLogListContainer li:last-child { border-bottom: none; }
        #fullMoodLogViewModal #fullLogListContainer .log-emoji { font-size: 2.2em; margin-top: 2px; flex-shrink: 0; }
        #fullMoodLogViewModal #fullLogListContainer .log-details { flex-grow: 1; }
        #fullMoodLogViewModal #fullLogListContainer .log-note {
            font-size: 1em; color: var(--text-color); margin-bottom: 8px;
            white-space: pre-wrap; word-break: break-word;
        }
        #fullMoodLogViewModal #fullLogListContainer .log-timestamp { font-size: .85em; color: var(--text-light); }
        #fullMoodLogViewModal .empty-full-log-message { text-align: center; padding: 40px; font-size: 1.1em; color: var(--text-light); }

        #reminderCalendarModal .modal-content { max-width: 400px; padding: 0; }
        #reminderCalendarModal #calendarMonthYear { font-weight: 700; font-size: 1.2em; }
        #reminderCalendarModal #prevMonthBtn, #reminderCalendarModal #nextMonthBtn {
            background: none; border: none; font-size: 2em; color: var(--text-color);
            cursor: pointer; padding: 0 10px; transition: transform .2s;
        }
        #reminderCalendarModal #prevMonthBtn:hover, #reminderCalendarModal #nextMonthBtn:hover { transform: scale(1.2); }
        #reminderCalendarModal #calendarGrid { display: grid; grid-template-columns: repeat(7,1fr); gap: 5px; padding: 20px; }
        #reminderCalendarModal .calendar-day-name, #reminderCalendarModal .calendar-day { text-align: center; padding: 8px; font-weight: 700; color: var(--text-light); }
        #reminderCalendarModal .calendar-day {
            cursor: pointer; border-radius: 50%; position: relative;
            transition: background-color .2s,color .2s,transform .2s;
            color: var(--text-color);
        }
        #reminderCalendarModal .calendar-day:hover { background-color: var(--accent-color-translucent); transform: scale(1.1); }
        #reminderCalendarModal .calendar-day.not-current-month { color: var(--text-light); opacity: .5; pointer-events: none; }
        #reminderCalendarModal .calendar-day.today { box-shadow: 0 0 0 2px solid var(--accent-color); }
        #reminderCalendarModal .calendar-day.selected { background-color: var(--accent-color)!important; color: #fff!important; font-weight: 700; transform: scale(1.1); }
        #reminderCalendarModal #reminderTimeSection { padding: 0 20px 20px; text-align: center; }
        #reminderCalendarModal #reminderTimeSection label { font-weight: 700; margin-right: 10px; }
        #reminderCalendarModal #reminderTimeInput {
            padding: 8px; border-radius: 8px; border: 1px solid var(--widget-border-color);
            background-color: var(--input-bg); color: var(--text-color); font-family: inherit;
        }

        #horoscopeModal .modal-content {
            max-width: 550px; padding: 40px; text-align: center; color: #fff;
            position: relative; overflow: hidden;
            background: linear-gradient(270deg, #4d2f8c, #2c3e50, #8a63d2, #463d60);
            background-size: 400% 400%;
            animation: popIn 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards, gradient-flow 15s ease infinite;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        #horoscopeEmoji { font-size: 5em; margin-bottom: 20px; text-shadow: 0 0 15px rgba(255, 255, 255, 0.5); }
        #horoscopeModalText {
            font-size: 1.4em; font-style: italic; font-weight: 300; line-height: 1.6;
            min-height: 120px; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        #streakModal .modal-content { max-width: 480px; text-align: center; padding: 25px; }
        #streakModal .modal-content h3 {
            display: flex; align-items: center; justify-content: center;
            gap: 10px; margin-top: 0; margin-bottom: 15px;
            font-size: 1.6em; font-weight: 600; color: var(--text-color);
        }
        #streakModal .modal-actions { justify-content: center; padding-top: 20px; }
        #streakModalMessage { font-size: 1.2em; color: var(--text-light); margin-bottom: 25px; line-height: 1.5; }
        .streak-week-view { display: flex; justify-content: space-around; gap: 10px; }
        .day-slot { display: flex; flex-direction: column; align-items: center; gap: 8px; width: 45px; }
        .day-slot .day-name { font-weight: 700; color: var(--text-light); font-size: .9em; }
        .day-slot .day-icon {
            width: 45px; height: 45px; border-radius: 50%;
            background-color: var(--input-bg); border: 2px solid var(--widget-border-color);
            display: flex; justify-content: center; align-items: center;
            font-size: 1.8em; color: transparent;
            transition: all .4s cubic-bezier(.18,.89,.32,1.28);
        }
        .day-slot.active .day-icon {
            background-color: #ff9800; border-color: #ffc107; color: #fff;
            transform: scale(1.1); text-shadow: 0 0 10px rgba(0,0,0,.3);
        }
        .day-slot.today .day-name { color: var(--accent-color); font-weight: 900; }

        .pomodoro-widget { align-items: center; justify-content: center; gap: 20px; }
        .pomodoro-timer-visual { position: relative; width: 180px; height: 180px; margin: 0 auto 15px auto; }
        .pomodoro-timer-visual svg { width: 100%; height: 100%; transform: rotate(-90deg); }
        .pomodoro-timer-visual .timer-circle-bg { fill: none; stroke: var(--progress-bar-bg); stroke-width: 10; }
        .pomodoro-timer-visual .timer-circle-progress {
            fill: none; stroke: var(--accent-color); stroke-width: 10;
            stroke-linecap: round; transition: stroke-dashoffset 0.5s linear, stroke 0.5s;
        }
        #pomodoroDisplay {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); font-family: 'Poppins', monospace;
            font-size: 2.8em; font-weight: 600; color: var(--text-color);
        }
        .pomodoro-content-wrapper { flex-grow: 1; display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .pomodoro-status-line { text-align: center; }
        #pomodoroLabel { font-size: 1.2em; font-weight: 600; color: var(--accent-color); margin-bottom: 2px; }
        #sessionCounter { font-size: 0.9em; color: var(--text-light); }
        .pomodoro-controls { display: flex; justify-content: center; gap: 10px; width: 100%; }
        .pomodoro-controls button {
            width: 48px; height: 48px; border-radius: 50%;
            cursor: pointer; background-color: var(--button-bg);
            border: 1px solid var(--widget-border-color); color: var(--button-text);
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s;
        }
        .pomodoro-controls button:hover { transform: scale(1.1); background-color: var(--accent-color-translucent); box-shadow: 0 0 10px var(--accent-color-translucent); }
        .pomodoro-controls button svg { width: 24px; height: 24px; fill: currentColor; }
        .pomodoro-settings {
             width: 100%; max-height: 0; opacity: 0; overflow: hidden;
             transition: all 0.4s ease-out; border-top: 1px solid transparent;
             margin-top: 0; padding-top: 0; display: flex;
             justify-content: space-around; flex-wrap: wrap; gap: 10px;
        }
        .pomodoro-widget.settings-open .pomodoro-settings {
             max-height: 150px; opacity: 1; padding-top: 15px;
             margin-top: 15px; border-top-color: var(--widget-border-color);
        }
        .pomodoro-settings > div { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .pomodoro-settings label { font-size: 0.8em; font-weight: 500; color: var(--text-light); }
        .pomodoro-settings input[type="number"] {
            width: 55px; padding: 5px; border-radius: 8px;
            background-color: var(--input-bg); color: var(--text-color);
            border: 1px solid var(--widget-border-color);
            text-align: center; font-family: 'Poppins', sans-serif;
        }

        .habit-tracker-widget { display: flex; flex-direction: column; gap: 15px; }
        .habit-tracker-widget .add-habit-form { display: flex; gap: 10px; }
        .habit-tracker-widget #newHabitInput {
            flex-grow: 1; padding: 10px 15px; border: 1px solid var(--widget-border-color);
            border-radius: 10px; background-color: var(--input-bg);
            color: var(--text-color); font-size: 1em; outline: none;
            transition: box-shadow 0.2s; font-family: 'Poppins', sans-serif;
        }
        .habit-tracker-widget #newHabitInput:focus { box-shadow: 0 0 0 3px var(--accent-color-translucent); }
        .habit-tracker-widget #addHabitBtn {
            padding: 10px 20px; background-color: var(--accent-color);
            color: white; border: none; border-radius: 10px;
            cursor: pointer; font-weight: 600; font-size: 0.9em;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .habit-tracker-widget #addHabitBtn:hover { transform: translateY(-2px); box-shadow: var(--new-todo-btn-hover-shadow); }
        #habitListModern { display: flex; flex-direction: column; gap: 12px; max-height: 300px; overflow-y: auto; padding-right: 5px; }
        .habit-row {
            display: flex; align-items: center; padding: 10px;
            background-color: var(--button-bg); border-radius: 12px;
            border: 1px solid transparent; transition: all 0.2s ease;
        }
        .habit-row:hover { border-color: var(--widget-border-color); transform: translateX(3px); }
        .habit-details { flex-grow: 1; display: flex; align-items: center; gap: 8px; margin-right: 15px; }
        .habit-name-text { color: var(--text-color); font-weight: 500; cursor: pointer; padding: 2px 4px; border-radius: 4px; }
        .habit-name-text:focus { outline: 2px solid var(--accent-color); background-color: var(--accent-color-translucent); }
        .delete-habit-btn {
            background: none; border: none; color: var(--danger-color);
            font-size: 1.4em; cursor: pointer; border-radius: 50%;
            width: 24px; height: 24px; display: flex; align-items: center;
            justify-content: center; opacity: 0; transform: scale(0.8);
            transition: all 0.2s;
        }
        .habit-row:hover .delete-habit-btn { opacity: 0.7; transform: scale(1); }
        .delete-habit-btn:hover { opacity: 1; background-color: var(--danger-color); color: white; transform: scale(1.1); }
        .habit-week-tracker { display: flex; gap: 6px; }
        .habit-week-tracker input[type="checkbox"] { display: none; }
        .day-label {
            width: 30px; height: 30px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.85em; font-weight: 600; cursor: pointer;
            border: 2px solid var(--widget-border-color); color: var(--text-light);
            background-color: transparent; transition: all 0.2s ease;
        }
        .day-label:hover { background-color: var(--accent-color-translucent); border-color: var(--accent-color); }
        .habit-week-tracker input[type="checkbox"]:checked + .day-label {
            background-color: var(--accent-color); border-color: var(--accent-color);
            color: white; transform: scale(1.1);
        }
        .day-label.disabled { opacity: 0.5; cursor: not-allowed; background-color: transparent; }
        .day-label.disabled:hover { transform: none; border-color: var(--widget-border-color); }
        .habit-table-container { display: none; }

        #notepadModal .modal-content {
            max-width: 900px; width: 90%; height: 85vh;
            padding: 0; display: flex; flex-direction: column;
            overflow: hidden;
        }
        .notepad-container { flex-grow: 1; display: flex; min-height: 0; }
        .notes-list-panel { width: 250px; flex-shrink: 0; border-right: 1px solid var(--widget-border-color); display: flex; flex-direction: column; }
        .notes-list-header { padding: 10px; border-bottom: 1px solid var(--widget-border-color); }
        #new-note-btn {
            width: 100%; padding: 10px; background-color: var(--accent-color);
            color: white; border: none; border-radius: 8px;
            font-weight: 600; cursor: pointer; transition: transform 0.2s;
        }
        #new-note-btn:hover { transform: scale(1.03); }
        #notes-list { list-style: none; padding: 10px; margin: 0; overflow-y: auto; flex-grow: 1; }
        .note-list-item {
            padding: 12px 15px; border-radius: 8px; cursor: pointer;
            margin-bottom: 8px; transition: background-color 0.2s; position: relative;
        }
        .note-list-item:hover { background-color: var(--button-bg); }
        .note-list-item.active { background-color: var(--accent-color-translucent); font-weight: 600; }
        .note-list-item-title { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; margin-right: 25px; }
        .note-list-item-date { font-size: 0.75em; color: var(--text-light); margin-top: 4px; }
        .delete-note-btn {
            position: absolute; top: 50%; right: 10px; transform: translateY(-50%);
            background: none; border: none; color: var(--danger-color);
            font-size: 1.4em; cursor: pointer; border-radius: 50%;
            width: 24px; height: 24px; display: flex; align-items: center;
            justify-content: center; opacity: 0.6; transition: opacity 0.2s;
        }
        .note-list-item:hover .delete-note-btn { opacity: 1; }
        .delete-note-btn:hover { color: var(--danger-color-hover); background-color: var(--accent-color-translucent); }
        .note-editor-panel { flex-grow: 1; display: flex; flex-direction: column; padding: 20px; }
        .note-editor-panel.empty { justify-content: center; align-items: center; color: var(--text-light); font-size: 1.2em; }
        #active-note-title {
            font-size: 1.8em; font-weight: 600; padding: 10px;
            border: none; background: transparent; color: var(--text-color);
            width: 100%; margin-bottom: 10px;
            border-bottom: 1px solid var(--widget-border-color); outline: none;
        }
        #active-note-content {
            flex-grow: 1; width: 100%; border: none; padding: 15px;
            font-family: 'Poppins', 'Segoe UI', 'Roboto', sans-serif;
            font-size: 1em; background-color: var(--input-bg);
            color: var(--text-color); outline: none; resize: none;
            border-radius: 12px; transition: box-shadow 0.2s;
        }
        #active-note-content:focus { box-shadow: 0 0 0 3px var(--accent-color-translucent); }
        #notepad-statusbar { padding-top: 10px; text-align: right; font-size: 0.8em; color: var(--text-light); }

        #focusStatsModal .modal-content { max-width: 650px; padding: 25px; }
        .stats-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .stats-header h3 { font-size: 1.8em; font-weight: 600; margin: 0; }
        .stats-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: var(--button-bg); padding: 15px; border-radius: 12px; text-align: center; }
        .stat-card .stat-value { font-size: 1.8em; font-weight: 600; color: var(--accent-color); }
        .stat-card .stat-label { font-size: 0.9em; font-weight: 500; color: var(--text-light); margin-top: 5px; }
        .stats-chart-container h4 { font-size: 1.2em; margin-bottom: 15px; text-align: center; color: var(--text-light); }
        .stats-chart {
            display: flex; justify-content: space-around; align-items: flex-end;
            height: 150px; border-left: 2px solid var(--widget-border-color);
            border-bottom: 2px solid var(--widget-border-color); padding-top: 10px;
        }
        .chart-bar-group { display: flex; flex-direction: column; align-items: center; gap: 5px; flex-grow: 1; }
        .chart-bar {
            width: 60%; background: var(--accent-color-translucent);
            border-radius: 5px 5px 0 0; transition: height 0.5s ease-out;
            border: 1px solid var(--accent-color);
        }
        .chart-label { font-size: 0.8em; font-weight: 600; color: var(--text-light); }

        @keyframes fadeIn {
            from { opacity: 0; backdrop-filter: blur(0); }
            to { opacity: 1; backdrop-filter: blur(5px); }
        }
        @keyframes fadeOut {
            from { opacity: 1; backdrop-filter: blur(5px); }
            to { opacity: 0; backdrop-filter: blur(0); }
        }
        @keyframes popIn {
            from { transform: scale(.8) translateY(20px); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes popOut {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(.8) translateY(20px); opacity: 0; }
        }
        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        #confetti-container {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none; overflow: hidden;
            z-index: 2000;
        }
        .confetti-piece { position: absolute; width: 8px; height: 16px; opacity: 0; animation: fall 3s ease-out forwards; }
        @keyframes fall {
            0% { opacity: 1; transform: translateY(-10vh) rotateZ(0); }
            100% { opacity: 0; transform: translateY(110vh) rotateZ(720deg); }
        }
        #toast-container {
            position: fixed; bottom: 20px; right: 20px;
            z-index: 2100; display: flex;
            flex-direction: column-reverse; gap: 10px;
        }
        .toast {
            padding: 15px 20px; border-radius: 12px;
            color: #fff; font-size: 1em; font-weight: 500;
            box-shadow: 0 4px 15px rgba(0,0,0,.2);
            transform: translateX(120%); opacity: 0;
            transition: transform .5s cubic-bezier(.18,.89,.32,1.28),opacity .5s ease;
            border: 1px solid rgba(255,255,255,.3);
            text-shadow: 1px 1px 2px rgba(0,0,0,.2);
        }
        .toast.show { transform: translateX(0); opacity: 1; }
        .toast.toast-info { background-color: var(--accent-color); }
        .toast.toast-achievement { background: linear-gradient(45deg,#ffaf07,#f44336); }
        
        @media (max-width: 1400px) { .widgets-container { grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); } }
        @media (max-width: 992px) {
            body { padding-left: 10px; padding-right: 10px; padding-top: 80px; }
            header { left: 10px; }
            .left-sidebar { display: none; }
            .widgets-container { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            body { padding-top: 150px; }
            header { flex-direction: column; align-items: flex-start; height: auto; padding: 10px; top: 10px; left: 10px; right: 10px; }
            .logo { position: absolute; top: 10px; left: 15px; }
            header nav { margin-top:  50px; width: 100%; display: flex; justify-content: space-around; }
            .motivational-quote-banner { flex-direction: column; text-align: center; }
            .pomodoro-timer-visual { width: 160px; height: 160px; }
            #pomodoroDisplay { font-size: 2.4em; }
        }
    </style>
</head>
<body>

    <div id="loader">Loading Planner...</div>
    
    <div id="app-container">
        <header>
            <div class="logo">
                <label for="avatarInput" title="Click to change profile picture">
                    <img id="avatarImage" src="https://cdn.vectorstock.com/i/1000v/66/13/default-avatar-profile-icon-social-media-user-vector-49816613.jpg" alt="User Avatar">
                </label>
                <button id="deleteAvatarBtn" class="delete-avatar-btn" title="Delete profile picture">×</button>
                <input type="file" id="avatarInput" accept="image/png, image/jpeg, image/gif">
            </div>
            <nav>
                <a href="index.html" id="navHome">Home</a>
                <a href="about.html" id="navAbout">About Us</a>
                <a href="resources.html" id="navResources">Resources</a>
            </nav>
            <div class="header-right">
                <div class="search-bar">
                    <input type="search" id="searchInput" placeholder="Search tasks & reminders...">
                    <button id="searchButton">🔍</button>
                </div>
                <button id="signOutBtn">Sign Out</button>
            </div>
        </header>

        <aside class="left-sidebar">
            <button id="newPageBtn">+ Add New List</button>
            <button class="sidebar-tab-button" id="openNotepadBtn">
                <span class="tab-icon">📝</span> Notepad
            </button>
            <button class="sidebar-tab-button" id="openFocusStatsBtn">
                <span class="tab-icon">📊</span> Focus Stats
            </button>
            <button class="sidebar-tab-button" id="viewMoodLogTabBtn">
                <span class="tab-icon">📜</span> View Full Mood Log
            </button>
            <div class="mood-tracker-launcher">
                <span class="mood-emoji-trigger" data-mood="happy" data-emoji="😊" title="Log Happy Mood">😊</span>
                <span class="mood-emoji-trigger" data-mood="sad" data-emoji="😟" title="Log Sad Mood">😟</span>
                <span class="mood-emoji-trigger" data-mood="neutral" data-emoji="😐" title="Log Neutral Mood">😐</span>
                <span class="mood-emoji-trigger" data-mood="excited" data-emoji="🥳" title="Log Excited Mood">🥳</span>
                <span class="mood-emoji-trigger" data-mood="stressed" data-emoji="😫" title="Log Stressed Mood">😫</span>
            </div>
            <div class="sidebar-weather">
                <div class="weather-header">
                    <div id="weatherIcon">☀️</div>
                    <div class="weather-details">
                        <div id="weatherTemp">--°F</div>
                        <div id="weatherCity">Loading...</div>
                    </div>
                </div>
                <p id="weatherDesc">Fetching weather...</p>
            </div>
            
            <button class="sidebar-tab-button" id="sidebarStreakBtn">
                <span class="tab-icon">🔥</span> View Streak
            </button>
            <button class="sidebar-tab-button" id="themeToggleBtn">
                <span id="themeIcon" class="tab-icon">☀️</span>
                <span id="themeToggleText">Light/Dark Mode</span>
            </button>
        </aside>

        <main class="main-content">
            <section class="motivational-quote-banner">
                <p id="motivationalQuoteP">"Loading motivational quote..."</p>
            </section>
            
            <p id="noSearchResults" style="display:none; text-align:center; color: var(--text-light);">No items match your search.</p>
            
            <div class="widgets-container">
                <section class="widget reminders-widget" id="remindersWidget">
                    <h2 class="drag-handle">Reminders</h2>
                    <ul id="remindersList"></ul>
                    <div class="add-reminder-form">
                        <input type="text" id="newReminderInput" placeholder="Type reminder, then click '+'...">
                        <button id="addReminderBtn" title="Set Date & Time for Reminder">+</button>
                    </div>
                </section>
                <section class="widget calendar-widget" id="calendarWidget">
                    <h2 class="drag-handle">Calendar</h2>
                    <div class="calendar-header">
                        <button id="calPrevMonthBtn" class="calendar-nav-btn" title="Previous Month"><</button>
                        <h3 id="calMonthYear">Month Year</h3>
                        <button id="calNextMonthBtn" class="calendar-nav-btn" title="Next Month">></button>
                    </div>
                    <div id="widgetCalendarGrid" class="calendar-grid-widget"></div>
                </section>
                <section class="widget pomodoro-widget" id="pomodoroWidget">
                    <h2 class="drag-handle">Pomodoro</h2>
                    <div class="pomodoro-content-wrapper">
                        <div class="pomodoro-timer-visual">
                            <svg>
                                <circle class="timer-circle-bg" cx="90" cy="90" r="80"></circle>
                                <circle id="pomodoroProgress" class="timer-circle-progress" cx="90" cy="90" r="80"></circle>
                            </svg>
                            <div id="pomodoroDisplay">25:00</div>
                        </div>
                        <div class="pomodoro-status-line">
                            <h3 id="pomodoroLabel">Focus</h3>
                            <p id="sessionCounter">1 / 4</p>
                        </div>
                        <div class="pomodoro-controls">
                            <button id="startPomodoroBtn" title="Start"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg></button>
                            <button id="pausePomodoroBtn" title="Pause" style="display:none;"><svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg></button>
                            <button id="resetPomodoroBtn" title="Reset"><svg viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"></path></svg></button>
                            <button id="pomodoroSettingsBtn" title="Settings"><svg viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"></path></svg></button>
                        </div>
                         <div class="pomodoro-settings">
                             <div>
                                 <label for="customMinutes">Focus (min)</label>
                                 <input type="number" id="customMinutes" value="25" min="1" max="90">
                             </div>
                             <div>
                                 <label for="breakMinutes">Break (min)</label>
                                 <input type="number" id="breakMinutes" value="5" min="1" max="30">
                             </div>
                             <div>
                                 <label for="totalSessions">Sessions</label>
                                 <input type="number" id="totalSessions" value="4" min="1" max="10">
                             </div>
                         </div>
                    </div>
                    <audio id="alertSound" src="https://www.soundjay.com/buttons/beep-07.mp3" preload="auto"></audio>
                </section>
                
                <section class="widget habit-tracker-widget" id="habitTrackerWidget">
                    <h2 class="drag-handle">Habit Tracker</h2>
                    <div class="add-habit-form">
                        <input type="text" id="newHabitInput" placeholder="e.g., Drink 8 glasses of water">
                        <button id="addHabitBtn">Add Habit</button>
                    </div>
                    <div id="habitListModern"></div>
                </section>
            </div>
            
            <section class="horoscope-section glass">
                <div class="horoscope-header">
                    <span class="horoscope-icon">🔮</span>
                    <h3>Your Daily Insight</h3>
                </div>
                <button id="getHoroscopeBtn">Reveal Today's Horoscope</button>
            </section>

            <div id="streakDisplay" class="streak-container" title="Your current streak">
                <span id="streakCount">0</span> 
                <span class="fire-icon">🔥</span>
            </div>
        </main>
        
        <!-- All Modals -->
        <div id="notepadModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Notepad</h3>
                    <button id="closeNotepadBtn" class="close-modal-btn" title="Close Notepad">
                        <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <div class="notepad-container">
                    <div class="notes-list-panel">
                        <div class="notes-list-header"><button id="new-note-btn">+ New Note</button></div>
                        <ul id="notes-list"></ul>
                    </div>
                    <div id="note-editor-panel" class="note-editor-panel empty">Select a note or create a new one.</div>
                </div>
            </div>
        </div>

        <div id="focusStatsModal" class="modal-overlay">
            <div class="modal-content">
                <div class="stats-header">
                    <h3>Focus Statistics</h3>
                    <button id="closeFocusStatsBtn" class="close-modal-btn" title="Close Stats">
                         <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <div class="stats-cards">
                    <div class="stat-card"><div id="statsFocusTime" class="stat-value">0m 0s</div><div class="stat-label">Focus</div></div>
                    <div class="stat-card"><div id="statsTasks" class="stat-value">0</div><div class="stat-label">Tasks</div></div>
                    <div class="stat-card"><div id="statsSessions" class="stat-value">0</div><div class="stat-label">Sessions</div></div>
                     <div class="stat-card"><div id="statsBreakTime" class="stat-value">0m 0s</div><div class="stat-label">Break</div></div>
                </div>
                <div class="stats-chart-container">
                    <h4>Last 7 Days Focus</h4>
                    <div id="statsChart" class="stats-chart"></div>
                </div>
            </div>
        </div>

        <div id="moodLoggingModal" class="modal-overlay">
            <div class="modal-content">
                <h3>How are you feeling?</h3>
                <div id="modalSelectedMoodEmoji"></div>
                <textarea id="moodNoteInput" placeholder="Add a note (optional)..."></textarea>
                <div class="modal-actions">
                    <button id="cancelMoodLogBtn" class="cancel-mood-btn">Cancel</button>
                    <button id="saveMoodLogBtn" class="save-mood-btn">Log Mood</button>
                </div>
            </div>
        </div>
        
        <div id="fullMoodLogViewModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Full Mood Log</h3>
                    <button id="closeFullLogViewBtn" class="close-modal-btn" title="Close Log View">
                         <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <div class="modal-body"><ul id="fullLogListContainer"></ul></div>
            </div>
        </div>

        <div id="reminderCalendarModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <button id="prevMonthBtn" title="Previous Month"><</button>
                    <h3 id="calendarMonthYear">Month Year</h3>
                    <button id="nextMonthBtn" title="Next Month">></button>
                </div>
                <div id="calendarGrid"></div>
                <div id="reminderTimeSection">
                    <label for="reminderTimeInput">Set Time:</label>
                    <input type="time" id="reminderTimeInput">
                </div>
                <div class="modal-actions">
                    <button id="cancelReminderBtn" class="cancel-mood-btn">Cancel</button>
                    <button id="setReminderBtn" class="save-mood-btn">Set Reminder</button>
                </div>
            </div>
        </div>
        
        <div id="horoscopeModal" class="modal-overlay">
            <div class="modal-content">
                <button id="closeHoroscopeBtn" class="close-modal-btn" title="Close">
                     <svg viewBox="0 0 24 24" style="stroke: white;"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
                <div id="horoscopeEmoji"></div>
                <p id="horoscopeModalText"></p>
            </div>
        </div>
        
        <div id="streakModal" class="modal-overlay">
            <div class="modal-content">
                 <h3>Your Weekly Progress 🎉</h3>
                 <p id="streakModalMessage"></p>
                 <div id="streakWeekView" class="streak-week-view"></div>
                 <div class="modal-actions"><button id="closeStreakModalBtn" class="cancel-mood-btn">Close</button></div>
            </div>
        </div>
        
        <div id="confetti-container"></div>
        <div id="toast-container"></div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
        apiKey: "AIzaSyA5uXk2bnfbZ0ZMQSsRzOXzU4jjZN0-sPM",
        authDomain: "studentwellnessplanner.firebaseapp.com",
        projectId: "studentwellnessplanner",
        storageBucket: "studentwellnessplanner.firebasestorage.app",
        messagingSenderId: "1084830559333",
        appId: "1:1084830559333:web:dc5d435854bad565476a8c"
        };

        // --- Firebase Initialization ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let currentUserId = null;
        let dbRefs = {};

        // --- DOM Elements ---
        const loader = document.getElementById('loader');
        const appContainer = document.getElementById('app-container');
        const signOutBtn = document.getElementById('signOutBtn');

        // --- Authentication State Change ---
        onAuthStateChanged(auth, user => {
            if (user) {
                currentUserId = user.uid;
                // Define database references now that we have the user ID
                dbRefs = {
                    userData: doc(db, 'users', currentUserId),
                    appData: doc(db, 'users', currentUserId, 'app', 'data'),
                    notes: doc(db, 'users', currentUserId, 'app', 'notes')
                };
                initializeAppLogic();
            } else {
                window.location.replace('./login.html');
            }
        });

        signOutBtn.addEventListener('click', () => {
            signOut(auth).catch((error) => console.error('Sign Out Error', error));
        });

        // --- Main App Initialization ---
        async function initializeAppLogic() {
            // Local state variables
            let todoCardsData = [], reminders = [], habitsData = [], notes = [], moodLog = [], pomodoroState = {}, focusStats = {}, streakData = {};
            let widgetOrder = [];
            let activeNoteId = null;
            let horoscopeData = {};

            // --- Data Helper Functions ---
            const fetchData = async () => {
                const appDoc = await getDoc(dbRefs.appData);
                const notesDoc = await getDoc(dbRefs.notes);
                const userDoc = await getDoc(dbRefs.userData);

                const data = appDoc.data() || {};
                const userData = userDoc.data() || {};
                
                todoCardsData = data.todoCards || [];
                reminders = data.reminders || [];
                habitsData = data.habits || [];
                moodLog = data.moodLog || [];
                pomodoroState = data.pomodoroState || {};
                focusStats = data.focusStats || {};
                streakData = data.streakData || { count: 0, lastLogin: null, loginHistory: [] };
                widgetOrder = data.widgetOrder || [];
                horoscopeData = data.horoscopeData || {};
                
                if (notesDoc.exists()) {
                    const notesData = notesDoc.data();
                    notes = notesData.notes || [];
                    activeNoteId = notesData.activeNoteId || null;
                }
                
                document.body.classList.toggle('dark-mode', userData.theme === 'dark');
                document.getElementById('themeIcon').textContent = userData.theme === 'dark' ? '🌙' : '☀️';
                document.getElementById('avatarImage').src = userData.avatar || 'https://cdn.vectorstock.com/i/1000v/66/13/default-avatar-profile-icon-social-media-user-vector-49816613.jpg';
            };

            const saveData = async (key, value) => {
                try {
                    await setDoc(dbRefs.appData, { [key]: value }, { merge: true });
                } catch (error) {
                    console.error("Error saving data for key:", key, error);
                }
            };
            
            const saveNotesData = async () => {
                await setDoc(dbRefs.notes, { notes, activeNoteId });
            };

            const saveUserData = async (key, value) => {
                 try {
                    await setDoc(dbRefs.userData, { [key]: value }, { merge: true });
                } catch (error) {
                    console.error("Error saving user data for key:", key, error);
                }
            };

            // --- Initial Fetch ---
            await fetchData();
            
            // --- Show App & Hide Loader ---
            loader.style.opacity = '0';
            setTimeout(() => {
                loader.style.display = 'none';
                appContainer.style.display = 'block';
            }, 300);

            // --- Run All Setup Functions ---
            setupAllFeatures();

            // --- Centralized Setup Function ---
            function setupAllFeatures() {
                let typingIntervalId = null;
                let pomodoroInterval;

                // --- Helper Functions ---
                function getYYYYMMDD(date) { return date.toISOString().split('T')[0]; }
                function showToast(message, type = 'info') {
                    const container = document.getElementById('toast-container');
                    if (!container) return;
                    const toast = document.createElement('div');
                    toast.className = `toast toast-${type}`;
                    toast.textContent = message;
                    container.appendChild(toast);
                    setTimeout(() => toast.classList.add('show'), 100);
                    setTimeout(() => {
                        toast.classList.remove('show');
                        toast.addEventListener('transitionend', () => toast.remove());
                    }, 4000);
                }
                function triggerConfetti() {
                    const confettiContainer = document.getElementById('confetti-container');
                    if (!confettiContainer) return;
                    for (let i = 0; i < 50; i++) {
                        const piece = document.createElement('div');
                        piece.classList.add('confetti-piece');
                        piece.style.left = `${Math.random() * 100}vw`;
                        const colors = ['#6C63FF', '#2ecc71', '#3498db', '#e74c3c', '#f1c40f'];
                        piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        piece.style.animationDelay = `${Math.random() * 0.5}s`;
                        confettiContainer.appendChild(piece);
                        setTimeout(() => piece.remove(), 3500);
                    }
                }
                function selectElementContents(el) {
                    if (!el) return;
                    const range = document.createRange();
                    range.selectNodeContents(el);
                    const sel = window.getSelection();
                    if (sel) {
                        sel.removeAllRanges();
                        sel.addRange(range);
                    }
                }

                // --- Theme & Avatar Listeners ---
                document.getElementById('themeToggleBtn').addEventListener('click', () => {
                    document.body.classList.toggle('dark-mode');
                    const newTheme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
                    document.getElementById('themeIcon').textContent = newTheme === 'dark' ? '🌙' : '☀️';
                    saveUserData('theme', newTheme);
                });
                document.getElementById('avatarInput').addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const imageDataUrl = e.target.result;
                            document.getElementById('avatarImage').src = imageDataUrl;
                            saveUserData('avatar', imageDataUrl);
                        };
                        reader.readAsDataURL(file);
                    }
                });
                document.getElementById('deleteAvatarBtn').addEventListener('click', () => {
                    const defaultUrl = 'https://cdn.vectorstock.com/i/1000v/66/13/default-avatar-profile-icon-social-media-user-vector-49816613.jpg';
                    document.getElementById('avatarImage').src = defaultUrl;
                    saveUserData('avatar', defaultUrl);
                });

                // --- Motivational Quotes ---
                const quotes = [
                    "The only way to do great work is to love what you do. – Steve Jobs",
                    "Believe you can and you're halfway there. – Theodore Roosevelt",
                    "Your limitation—it's only your imagination.",
                    "Push yourself, because no one else is going to do it for you.",
                    "Great things never come from comfort zones."
                ];
                document.getElementById('motivationalQuoteP').textContent = `"${quotes[Math.floor(Math.random() * quotes.length)]}"`;

                // --- To-Do Cards ---
                const widgetsContainer = document.querySelector('.widgets-container');
                function renderTodoCards() {
                    document.querySelectorAll('.todo-card').forEach(card => card.remove());
                    todoCardsData.forEach(cardData => {
                        const cardElement = document.createElement('section');
                        cardElement.className = 'widget todo-card';
                        cardElement.id = cardData.id;
                        cardElement.innerHTML = `
                            <div class="widget-header drag-handle">
                                <h2 class="card-title"><span class="card-title-text" contenteditable="true">${cardData.title}</span></h2>
                                <button class="close-btn close-card-btn" title="Close this list">×</button>
                            </div>
                            <ul class="task-list"></ul>
                            <button class="add-task-btn">+ Add New Task</button>
                            <div class="progress-item">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                                <p class="progress-label">0% Complete</p>
                            </div>`;
                        widgetsContainer.appendChild(cardElement);

                        cardData.tasks.forEach(task => addTaskToTodoCard(cardElement, task.text, task.completed, task.dueDate, task.id));
                        updateProgressForCard(cardElement);

                        const cardTitleText = cardElement.querySelector('.card-title-text');
                        cardTitleText.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); cardTitleText.blur(); } });
                        cardTitleText.addEventListener('blur', () => {
                            const cardToUpdate = todoCardsData.find(c => c.id === cardElement.id);
                            if(cardToUpdate) cardToUpdate.title = cardTitleText.textContent.trim();
                            saveData('todoCards', todoCardsData);
                        });
                    });
                }
                function addTaskToTodoCard(cardElement, taskText, completed, dueDate, taskId) {
                    const taskList = cardElement.querySelector('.task-list');
                    const taskItem = document.createElement('li');
                    taskItem.dataset.taskId = taskId;
                    taskItem.innerHTML = `
                        <input type="checkbox" class="task-checkbox" ${completed ? 'checked' : ''}>
                        <div class="task-content">
                            <span class="task-label" contenteditable="true">${taskText}</span>
                            <input type="date" class="task-due-date-input" value="${dueDate}">
                        </div>
                        <button class="delete-task-btn" title="Delete Task">×</button>`;
                    taskList.appendChild(taskItem);

                    const cardData = todoCardsData.find(card => card.id === cardElement.id);
                    let taskData = cardData.tasks.find(task => task.id === taskId);
                    
                    taskItem.querySelector('.task-checkbox').addEventListener('change', (e) => {
                        if (taskData) taskData.completed = e.target.checked;
                        if (e.target.checked) { triggerConfetti(); logTaskCompletion(); }
                        saveData('todoCards', todoCardsData);
                        updateProgressForCard(cardElement);
                        checkOverdueStatus(taskItem, taskData.completed, taskData.dueDate);
                    });
                    taskItem.querySelector('.task-label').addEventListener('blur', (e) => {
                        if (taskData) taskData.text = e.target.textContent.trim();
                        saveData('todoCards', todoCardsData);
                    });
                    taskItem.querySelector('.task-due-date-input').addEventListener('change', (e) => {
                        if (taskData) taskData.dueDate = e.target.value;
                        saveData('todoCards', todoCardsData);
                        checkOverdueStatus(taskItem, taskData.completed, taskData.dueDate);
                    });
                    taskItem.querySelector('.delete-task-btn').addEventListener('click', () => {
                        cardData.tasks = cardData.tasks.filter(t => t.id !== taskId);
                        taskItem.remove();
                        updateProgressForCard(cardElement);
                        saveData('todoCards', todoCardsData);
                    });
                    checkOverdueStatus(taskItem, completed, dueDate);
                }
                function createTodoCard() {
                    const newCardId = `todoCard-${Date.now()}`;
                    const newCardData = { id: newCardId, title: `Untitled List ${todoCardsData.length + 1}`, tasks: [] };
                    todoCardsData.push(newCardData);
                    const newTask = { id: `task-${Date.now()}`, text: "New Task", completed: false, dueDate: '' };
                    newCardData.tasks.push(newTask);
                    renderTodoCards();
                    const newlyCreatedCardElement = document.getElementById(newCardId);
                    if (newlyCreatedCardElement) {
                        const cardTitleText = newlyCreatedCardElement.querySelector('.card-title-text');
                        newlyCreatedCardElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        cardTitleText.focus();
                        selectElementContents(cardTitleText);
                    }
                    saveData('todoCards', todoCardsData);
                }
                function updateProgressForCard(cardElement) {
                    if (!cardElement) return;
                    const checkboxes = cardElement.querySelectorAll('.task-list input[type="checkbox"]');
                    const progressBar = cardElement.querySelector('.progress-bar');
                    const progressLabel = cardElement.querySelector('.progress-label');
                    if (!progressBar || !progressLabel) return;

                    const totalTasks = checkboxes.length;
                    let checkedTasks = 0;
                    checkboxes.forEach(cb => {
                        const taskLabel = cb.closest('li').querySelector('.task-label');
                        if (cb.checked) {
                            checkedTasks++;
                            if (taskLabel) taskLabel.classList.add('completed');
                        } else {
                            if (taskLabel) taskLabel.classList.remove('completed');
                        }
                    });
                    const percentage = totalTasks === 0 ? 0 : Math.round((checkedTasks / totalTasks) * 100);
                    progressBar.style.width = `${percentage}%`;
                    progressLabel.textContent = `${checkedTasks} of ${totalTasks} tasks complete (${percentage}%)`;
                    progressBar.style.backgroundColor = (percentage === 100 && totalTasks > 0) ? 'var(--progress-bar-fill-complete)' : (percentage < 50 ? 'var(--progress-bar-fill-1)' : 'var(--progress-bar-fill-2)');
                }
                function checkOverdueStatus(taskItem, completed, dueDate) {
                    const taskLabel = taskItem.querySelector('.task-label');
                    if (completed || !dueDate) {
                        taskLabel.classList.remove('overdue');
                        return;
                    }
                    const now = new Date();
                    const due = new Date(dueDate);
                    const nowNoTime = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    const dueNoTime = new Date(due.getFullYear(), due.getMonth(), due.getDate() + 1);
                    taskLabel.classList.toggle('overdue', dueNoTime < nowNoTime);
                }
                widgetsContainer.addEventListener('click', function(event) {
                    if (event.target.classList.contains('add-task-btn')) {
                        const cardElement = event.target.closest('.todo-card');
                        const cardData = todoCardsData.find(c => c.id === cardElement.id);
                        const newTask = { id: `task-${Date.now()}`, text: "New Task", completed: false, dueDate: '' };
                        cardData.tasks.push(newTask);
                        addTaskToTodoCard(cardElement, newTask.text, newTask.completed, newTask.dueDate, newTask.id);
                        saveData('todoCards', todoCardsData);
                    }
                    if (event.target.classList.contains('close-card-btn')) {
                        const cardElement = event.target.closest('.todo-card');
                        todoCardsData = todoCardsData.filter(card => card.id !== cardElement.id);
                        cardElement.remove();
                        saveData('todoCards', todoCardsData);
                    }
                });
                document.getElementById('newPageBtn').addEventListener('click', createTodoCard);

                // --- Reminders ---
                // ... (Reminder logic will go here)

                // --- And so on for all other features ---
            }
        }

    </script>
</body>
</html>
